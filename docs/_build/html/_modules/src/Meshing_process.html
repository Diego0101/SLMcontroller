<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>src.Meshing_process &#8212; SLM controller 1.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=039e1c02" />
    <script src="../../_static/documentation_options.js?v=292eb321"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for src.Meshing_process</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="sd">&quot;&quot;&quot;Meshing_process.py: Meshing process class. Used to handle gmesh GUI on OS that do not allow to run gmsh in a separate thread&quot;&quot;&quot;</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s2">&quot;Matteo Mazzanti&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright 2022, Matteo Mazzanti&quot;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;GNU GPL v3&quot;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s2">&quot;Matteo Mazzanti&quot;</span>

<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Process</span><span class="p">,</span> <span class="n">freeze_support</span>
<span class="kn">import</span> <span class="nn">threading</span>

<span class="kn">import</span> <span class="nn">tkinter</span> <span class="k">as</span> <span class="nn">tk</span>
<span class="kn">from</span> <span class="nn">tkinter</span> <span class="kn">import</span> <span class="n">ttk</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">gmsh</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>



<div class="viewcode-block" id="MeshingHandler">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler">[docs]</a>
<span class="k">class</span> <span class="nc">MeshingHandler</span><span class="p">(</span><span class="n">Process</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Meshing process class. Used to handle gmesh GUI on OS that do not allow to run gmsh in a separate thread.</span>
<span class="sd">    This takes care of initializing gmsh and generating the mesh according to the user parameters.</span>
<span class="sd">    Given a mesh it parses it in a np.array structure where each element has associated its meshID and returns it to the main thread.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        eventsDict (dict): Dictionary containing all the events used to communicate with the main thread.</span>
<span class="sd">        conditionsDict (dict): Dictionary containing all the conditions used to communicate with the main thread.</span>
<span class="sd">        queue (multiprocessing.Queue): Queue used to communicate with the main thread.</span>
<span class="sd">        SLM_x_res (int): SLM horizontal resolution.</span>
<span class="sd">        SLM_y_res (int): SLM vertical resolution.</span>
<span class="sd">        algorithm (int): Meshing algorithm to use.</span>
<span class="sd">        F (float): Meshing parameter (equation for meshing, see gmsh guide).</span>
<span class="sd">        algorithms (list): List of available meshing algorithms.</span>
<span class="sd">        algorithms_names (list): List of available meshing algorithms names.</span>
<span class="sd">        isMeshed (bool): True if the meshing process was already done, False otherwise.</span>
<span class="sd">        wasINIT (bool): True if gmsh was already initialized, False otherwise.</span>
<span class="sd">        Enabled (bool): True if the process should keep running, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventsDict</span><span class="p">,</span> <span class="n">conditionsDict</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="n">SLM_x_res</span><span class="p">,</span> <span class="n">SLM_y_res</span><span class="p">,</span> <span class="n">algorithm</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constructor for the MeshingHandler class. </span>
<span class="sd">        Initializes SLM parameters and sets the events and conditions used for communication with the main thread and the queue used for data transfer.</span>

<span class="sd">        Args:</span>
<span class="sd">            eventsDict (dict): Dictionary containing all the events used to communicate with the main thread.</span>
<span class="sd">            conditionsDict (dict): Dictionary containing all the conditions used to communicate with the main thread.</span>
<span class="sd">            queue (queue): Queue used to communicate with the main thread.</span>
<span class="sd">            SLM_x_res (int): SLM resolution in the horizontal direction.</span>
<span class="sd">            SLM_y_res (int): SLM resolution in the vertical direction.</span>
<span class="sd">            algorithm (int): Meshing algorithm to use.</span>
<span class="sd">            F (string): Meshing parameter (equation for meshing, see gmsh guide).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># freeze support is needed for compiling the executable</span>
        <span class="n">freeze_support</span><span class="p">()</span>
        <span class="n">Process</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># Settings running thread parameter (true = running, false = not running)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 4 points array where to store the points tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># 4 points array where to store the lines tags</span>

        <span class="c1"># Events signals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span> <span class="o">=</span> <span class="n">eventsDict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span> <span class="o">=</span> <span class="n">conditionsDict</span>

        <span class="c1"># Queue for data transfer between processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loopGUI</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># List of meshing algorithms</span>
        <span class="c1"># TODO : Make this global such that the GUI has 100% the same order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithms_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;MeshAdapt&quot;</span><span class="p">,</span> <span class="s2">&quot;Automatic&quot;</span><span class="p">,</span> <span class="s2">&quot;Initial mesh only&quot;</span><span class="p">,</span> <span class="s2">&quot;Delaunay&quot;</span><span class="p">,</span> <span class="s2">&quot;Frontal-Delaunay&quot;</span><span class="p">,</span> <span class="s2">&quot;BAMG&quot;</span><span class="p">,</span> <span class="s2">&quot;Frontal-Delaunay quads&quot;</span><span class="p">,</span> <span class="s2">&quot;Packing paralleograms&quot;</span><span class="p">,</span><span class="s2">&quot;Quasi-structured Quad&quot;</span><span class="p">]</span>

        <span class="c1"># Meshing parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">algorithm</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span> <span class="o">=</span> <span class="n">SLM_x_res</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span> <span class="o">=</span> <span class="n">SLM_y_res</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fltkInit</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isMeshed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="c1"># Settings for multiprocessing (stop the second process once done with the optimization algorithm)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="kc">True</span>
        
<div class="viewcode-block" id="MeshingHandler.checkUserMeshing">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.checkUserMeshing">[docs]</a>
    <span class="k">def</span> <span class="nf">checkUserMeshing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the user requested a meshing operation (remesh, closeGUI etc.) and performs it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;genMesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;generating mesh&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redomesh</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;genMesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>    

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;parseMesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;parseMesh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parsing mesh&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parseMesh</span><span class="p">()</span>
            <span class="c1"># Once done parsing notify the main thread</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;parsingCond&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;parsingCond&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;closeGUI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;showGUI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;closeGUI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fltkInit</span><span class="o">=</span><span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;savefile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;savefile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveMeshToFile</span><span class="p">()</span>
            <span class="c1"># Once done parsing notify the main thread</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;savefile&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;savefile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;loadfile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;loadfile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadMeshFromFile</span><span class="p">()</span>
            <span class="c1"># Once done parsing notify the main thread</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;loadfile&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conditionsDict</span><span class="p">[</span><span class="s1">&#39;loadfile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;terminate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="kc">False</span></div>

            




<div class="viewcode-block" id="MeshingHandler.run">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.run">[docs]</a>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Main function of the MeshingHandler class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Stay dormant till invoked for a new task</span>
        <span class="c1"># Wait for waking up event</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;generalEvent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;terminate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Enabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="c1"># In this case the user didn&#39;t wake up this process (no meshing done), so kill it</span>
            <span class="k">return</span>
        <span class="c1"># Start thread having the task of checking for new params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;generalEvent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_GMESH</span><span class="p">()</span>

        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">Enabled</span><span class="p">:</span>
            <span class="c1"># Check if the process should terminate (user closed the interface)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;waiting for event&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;generalEvent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkUserMeshing</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;showGUI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">is_set</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">fltkInit</span><span class="p">:</span>
                    <span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
                    <span class="c1">#gmsh.fltk.setCurrentWindow()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fltkInit</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span><span class="p">(</span><span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">isAvailable</span><span class="p">()):</span>
                    <span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># GUI was closed through other means (X)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;closeGUI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;generalEvent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="c1"># Check user requested events (remesh, closeGUI etc.)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Just woke up to check user requested events (remesh, closeGUI etc.)</span>
                <span class="c1"># Go back to sleep</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">eventsDict</span><span class="p">[</span><span class="s1">&#39;generalEvent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Prepare to terminate</span>
        <span class="k">if</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">isInitialized</span><span class="p">():</span>
            <span class="k">if</span><span class="p">(</span><span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">isAvailable</span><span class="p">):</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">fltk</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span></div>

    
<div class="viewcode-block" id="MeshingHandler.updatebar">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.updatebar">[docs]</a>
    <span class="k">def</span> <span class="nf">updatebar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the loading bar.</span>
<span class="sd">        The loading bar is extremely unnecessary. I had to add it as otherwise gmsh would not appear on top of the main GUI.</span>
<span class="sd">        This trick allows the gmsh GUI to appear on top of the main GUI and immediately visible to the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
            <span class="c1"># Sleeping time, used to give an impression of loading</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
        <span class="k">return</span> </div>

    
<div class="viewcode-block" id="MeshingHandler.loadMeshFromFile">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.loadMeshFromFile">[docs]</a>
    <span class="k">def</span> <span class="nf">loadMeshFromFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads a mesh from a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="c1"># If Gmsh wasn&#39;t initialized, do it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span><span class="p">:</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Remove previous model</span>
            <span class="c1"># If we have plenty of models in memory, remove them and load the new one</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="c1"># Set the new model as the active one</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setCurrent</span><span class="p">(</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">list</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">#self.checkLoadedMeshSize()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span></div>

    
    <span class="c1"># TODO: This part should check that the mesh actually would fit the slm sizes</span>
<div class="viewcode-block" id="MeshingHandler.checkLoadedMeshSize">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.checkLoadedMeshSize">[docs]</a>
    <span class="k">def</span> <span class="nf">checkLoadedMeshSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks if the loaded mesh fits the SLM size.</span>
<span class="sd">        </span>
<span class="sd">        Todo:</span>
<span class="sd">            This function is a work in progress, I did not find an elegant way of getting the size of a gmsh mesh (and check that is actually 2D).</span>
<span class="sd">            For now it assumes that the user knows what they&#39;re doing...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entities</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">entities</span><span class="p">:</span>
            <span class="n">boundary</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getBoundary</span><span class="p">([</span><span class="n">e</span><span class="p">])</span>
            <span class="n">elemTypes</span><span class="p">,</span> <span class="n">elemTags</span><span class="p">,</span> <span class="n">elemNodeTags</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElements</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - boundary entities &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">boundary</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">elemTypes</span><span class="p">:</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">numv</span><span class="p">,</span> <span class="n">parv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElementProperties</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; - Element type: &quot;</span> <span class="o">+</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;, order &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; (&quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">numv</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; nodes in param coord: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">parv</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span></div>




<div class="viewcode-block" id="MeshingHandler.saveMeshToFile">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.saveMeshToFile">[docs]</a>
    <span class="k">def</span> <span class="nf">saveMeshToFile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves the mesh to a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMeshed</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;saving mesh&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;something went wrong&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;wasn&#39;t meshed&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="MeshingHandler.showMeshGUI">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.showMeshGUI">[docs]</a>
    <span class="k">def</span> <span class="nf">showMeshGUI</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Shows the loading GUI. This is not necessary, but it allows the gmsh GUI to appear on top of the main GUI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Loading bar size</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mi">200</span> <span class="c1"># width for the Tk root</span>
        <span class="n">h</span> <span class="o">=</span> <span class="mi">20</span> <span class="c1"># height for the Tk root</span>

        <span class="c1"># Make it appear at the center of the screen </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="n">tk</span><span class="o">.</span><span class="n">Tk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Loading GMESH&quot;</span><span class="p">)</span>

        <span class="n">ws</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">winfo_screenwidth</span><span class="p">()</span> <span class="c1"># width of the screen</span>
        <span class="n">hs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">winfo_screenheight</span><span class="p">()</span> <span class="c1"># height of the screen</span>

        <span class="c1"># calculate x and y coordinates for the Tk root window</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">ws</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">hs</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">h</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">x</span><span class="si">%d</span><span class="s1">+</span><span class="si">%d</span><span class="s1">+</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">ttk</span><span class="o">.</span><span class="n">Progressbar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;determinate&quot;</span><span class="p">,</span>
                    <span class="n">takefocus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maximum</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">updatebar</span><span class="p">)</span><span class="c1">#, args=(self,))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
        <span class="c1"># Join process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></div>

        


<div class="viewcode-block" id="MeshingHandler.redomesh">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.redomesh">[docs]</a>
    <span class="k">def</span> <span class="nf">redomesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redoes the meshing operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Reload new mesh variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">getVariablesInQueue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reconstructMesh</span><span class="p">()</span>
        <span class="c1"># set new algorithm</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.Algorithm&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">algorithms</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span><span class="p">])</span>
        <span class="c1">#self.change_mesh_algo()</span>
        
        <span class="c1">#gmsh.model.mesh.unpartition()</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">setString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">setAsBackgroundMesh</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span><span class="p">)</span> 
        <span class="c1">#gmsh.model.mesh.setRecombine(2, self.pl)</span>
        <span class="c1"># To make quadrangles instead of triangles</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setRecombine</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">pl</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">createEdges</span><span class="p">()</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">createFaces</span><span class="p">()</span>
        <span class="c1"># Tells the saving function we actually have a Mesh to save</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">isMeshed</span> <span class="o">=</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="MeshingHandler.reconstructMesh">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.reconstructMesh">[docs]</a>
    <span class="k">def</span> <span class="nf">reconstructMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Deletes anre reconstructs the mesh + geometry.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span><span class="p">:</span> 
            <span class="c1">#gmsh.model.remove_entity_name(&quot;SLM Meshing&quot;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Math model: &quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span><span class="p">)</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span><span class="p">)</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">remove</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">remove</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]],[</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]]],</span><span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threshold</span><span class="o">=</span><span class="kc">None</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_GMESH</span><span class="p">()</span></div>


<div class="viewcode-block" id="MeshingHandler.init_GMESH">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.init_GMESH">[docs]</a>
    <span class="k">def</span> <span class="nf">init_GMESH</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initializes gmsh + creates basic geometry for the meshing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showMeshGUI</span><span class="p">()</span>
            <span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wasINIT</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;SLM Meshing&quot;</span><span class="p">)</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meshSize</span> <span class="o">=</span> <span class="n">lc</span><span class="p">)</span><span class="c1"># lc, 1)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meshSize</span> <span class="o">=</span> <span class="n">lc</span><span class="p">)</span><span class="c1"># lc, 2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meshSize</span> <span class="o">=</span> <span class="n">lc</span><span class="p">)</span><span class="c1"># lc, 3)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">=</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">meshSize</span> <span class="o">=</span> <span class="n">lc</span><span class="p">)</span><span class="c1"># lc, 4)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contour</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]])</span>
        <span class="c1">#self.contour = gmsh.model.geo.addCurveLoop([4, 1, -2, 3], 1)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pl</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">contour</span><span class="p">])</span>
        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mathModel</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;MathEval&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="MeshingHandler.parseMesh">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.parseMesh">[docs]</a>
    <span class="k">def</span> <span class="nf">parseMesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the mesh and returns it to the main thread.</span>
<span class="sd">        Converts from a gmsh to a numpy array where each element has associated its meshID.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;parsing mesh&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;getting nodes&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getNodes</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span><span class="p">):</span>  
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">getElementsByCoordinates</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span><span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span><span class="n">dim</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ids_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ids_list</span> <span class="o">=</span> <span class="p">[</span><span class="o">*</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids_list</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ids_list</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;done parsing mesh&quot;</span><span class="p">)</span></div>

    
        

<div class="viewcode-block" id="MeshingHandler.getVariablesInQueue">
<a class="viewcode-back" href="../../src.html#src.Meshing_process.MeshingHandler.getVariablesInQueue">[docs]</a>
    <span class="k">def</span> <span class="nf">getVariablesInQueue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Loads parameters from the queue (from the main thread).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SLM_x_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SLM_y_res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">SLM controller</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2023, Matteo Mazzanti.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>